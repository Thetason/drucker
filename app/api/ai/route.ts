import { NextRequest, NextResponse } from 'next/server'

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()
    const prompt = body.prompt
    const type = body.type || 'story'
    
    // í…œí”Œë¦¿ ê¸°ë°˜ ì‘ë‹µ ì§ì ‘ ë°˜í™˜
    return NextResponse.json({
      success: true,
      result: getTemplateResponse(prompt, type)
    })
  } catch (error) {
    console.error('API ì—ëŸ¬:', error)
    
    return NextResponse.json({
      success: false,
      result: 'ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
      error: String(error)
    }, { status: 500 })
  }
}

function getTemplateResponse(userInput: string, type: string): string {
  const templates: Record<string, (input: string) => string> = {
    story: (input) => `ğŸ“– í”½ì‚¬ ìŠ¤í† ë¦¬ ìŠ¤íŒŒì¸ ì œì•ˆ:

1. ë°°ê²½ (Once upon a time...):
   ë§ì€ ì‚¬ëŒë“¤ì´ ${input}ì— ëŒ€í•´ ê³ ë¯¼í•˜ê³  ìˆìŠµë‹ˆë‹¤.

2. ì¼ìƒ (Every day...):
   ë§¤ì¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ${input}ë¥¼ ì‹œë„í•˜ì§€ë§Œ ì˜ ë˜ì§€ ì•Šì•˜ì–´ìš”.

3. ì „í™˜ì  (Until one day...):
   ê·¸ëŸ°ë° ì´ëŸ° ë°©ë²•ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤! ${input}ì˜ í•µì‹¬ì€...

4. ê²°ê³¼ (Because of that...):
   ì´ ë°©ë²•ìœ¼ë¡œ ì™„ì „íˆ ë‹¬ë¼ì§„ ê²°ê³¼ë¥¼ ì–»ì—ˆì–´ìš”.

5. í•´ê²° (Until finally...):
   ì´ì œ ì—¬ëŸ¬ë¶„ë„ ${input}ë¡œ ë³€í™”ë¥¼ ê²½í—˜í•´ë³´ì„¸ìš”!

ğŸ’¡ íŒ: ê° ë‹¨ê³„ë¥¼ 3-5ì´ˆë¡œ ë°°ë¶„í•˜ë©´ 15-30ì´ˆ ë¦´ìŠ¤ì— ì™„ë²½í•©ë‹ˆë‹¤.`,
    
    idea: (input) => `ğŸ’¡ "${input}" ì•„ì´ë””ì–´ ë°œì „ ì œì•ˆ:

**1. ë” ê·¹ì ìœ¼ë¡œ (Drama+)**
â†’ ${input}ì˜ ë†€ë¼ìš´ ë¹„í¬&ì• í”„í„°ë¥¼ ê°•ì¡°
â†’ "ë‹¨ 3ì¼ë§Œì— ë‹¬ë¼ì§„ ë‚´ ëª¨ìŠµ" ê°ë„ë¡œ ì ‘ê·¼

**2. ë‹¤ë¥¸ ê´€ì ì—ì„œ (New Angle)**
â†’ ì´ˆë³´ì vs ì „ë¬¸ê°€ ì‹œê° ë¹„êµ
â†’ ì‹¤íŒ¨ ì‚¬ë¡€ë¥¼ í†µí•œ êµí›ˆìœ¼ë¡œ ì „í™˜

**3. íŠ¸ë Œë“œì™€ ê²°í•© (Trend Mix)**
â†’ ${input} + ì±Œë¦°ì§€ í˜•ì‹
â†’ ${input} + ASMR/íƒ€ì„ë©ìŠ¤ ì—°ì¶œ
â†’ ${input} + ìŠ¤í† ë¦¬í…”ë§ ìš”ì†Œ ì¶”ê°€

ğŸ¯ ì¶”ì²œ: ì²« 3ì´ˆì— ê°•ë ¬í•œ ì§ˆë¬¸ì´ë‚˜ ë¹„ì£¼ì–¼ í›… ë„£ê¸°!`,
    
    emotion: (input) => `ğŸ“ˆ "${input}" ê°ì • ê³¡ì„  ì„¤ê³„:

**ğŸ¬ 0-3ì´ˆ (í›… - Hook)**
ê°•ë ¬í•œ ì§ˆë¬¸ì´ë‚˜ ì¶©ê²©ì ì¸ ë¹„ì£¼ì–¼ë¡œ ì‹œì‘
ì˜ˆ: "ì´ê±° ëª¨ë¥´ë©´ ì†í•´ì˜ˆìš”!" / ë†€ë¼ìš´ ê²°ê³¼ë¬¼ ë¨¼ì € ë³´ì—¬ì£¼ê¸°

**â¬†ï¸ 4-8ì´ˆ (ë¹Œë“œì—… - Build)**
ë¬¸ì œ ìƒí™© ì œì‹œí•˜ê±°ë‚˜ ê³¼ì • ì‹œì‘
ê³µê°ëŒ€ í˜•ì„±: "ì €ë„ ê·¸ë¬ì–´ìš”..." 
ê¸´ì¥ê° ì¡°ì„±: "í•˜ì§€ë§Œ ì´ê±¸ ì•Œê³ ë‚˜ì„œ..."

**ğŸ”¥ 9-12ì´ˆ (í´ë¼ì´ë§¥ìŠ¤ - Peak)**
í•µì‹¬ ì†”ë£¨ì…˜ì´ë‚˜ ë†€ë¼ìš´ ê²°ê³¼ ê³µê°œ
ê°ì •ì˜ ì •ì : "ì™€!" / "ëŒ€ë°•!" ìœ ë„
ì‹œê°ì  ì„íŒ©íŠ¸ ìµœëŒ€í™”

**âœ¨ 13-15ì´ˆ (ë§ˆë¬´ë¦¬ - CTA)**
ëª…í™•í•œ í–‰ë™ ìœ ë„
"ì €ì¥ í•„ìˆ˜!", "íŒ”ë¡œìš°í•˜ê³  ë” ë³´ê¸°"
ì—¬ìš´ ë‚¨ê¸°ê¸°

ğŸ’« ê°ì • í¬ì¸íŠ¸: ê³µê°(ì´ˆë°˜) â†’ í˜¸ê¸°ì‹¬(ì¤‘ë°˜) â†’ ë§Œì¡±(í›„ë°˜)`,
    
    rules: (input) => `âœ… "${input}" ìŠ¤í† ë¦¬í…”ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸:

**ê°•ì  (ì˜ëœ ì ):**
âœ“ ëª…í™•í•œ ì£¼ì œì™€ ë©”ì‹œì§€
âœ“ íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤ ì„¤ì •
âœ“ ì‹¤ìš©ì ì¸ ì •ë³´ ì œê³µ

**ê°œì„  í¬ì¸íŠ¸:**
â— ì²« 3ì´ˆ í›… ê°•í™” í•„ìš”
â— ê°ì • ë³€í™” êµ¬ê°„ ì¶”ê°€
â— ë¹„ì£¼ì–¼ ì„íŒ©íŠ¸ ë³´ì™„
â— CTAë¥¼ ë” ëª…í™•í•˜ê²Œ

**êµ¬ì²´ì  ê°œì„  ì œì•ˆ:**

1ï¸âƒ£ ì˜¤í”„ë‹ ê°œì„ 
- "ì•Œê³  ìˆë‚˜ìš”?" â†’ "ì´ê±° ëª¨ë¥´ë©´ ì†í•´!"
- ì •ì ì¸ ì‹œì‘ â†’ ë™ì ì¸ ì•¡ì…˜ìœ¼ë¡œ ì‹œì‘

2ï¸âƒ£ ìŠ¤í† ë¦¬ êµ¬ì¡°
- ë¬¸ì œ ì œì‹œ â†’ í•´ê²° â†’ ê²°ê³¼ë¥¼ ëª…í™•í•˜ê²Œ
- íƒ€ì„ë©ìŠ¤ë‚˜ ì „í™˜ íš¨ê³¼ë¡œ í…œí¬ ì¡°ì ˆ

3ï¸âƒ£ ê°ì • ìš”ì†Œ
- ê³µê° í¬ì¸íŠ¸ 1-2ê°œ ì¶”ê°€
- ë†€ë¼ì›€/ê°ë™ ëª¨ë©˜íŠ¸ ì„¤ê³„

4ï¸âƒ£ ë§ˆë¬´ë¦¬
- "ì¢‹ì•„ìš”+ì €ì¥" ìœ ë„ ë©˜íŠ¸
- ë‹¤ìŒ ì½˜í…ì¸  ì˜ˆê³ ë¡œ íŒ”ë¡œìš° ìœ ë„

ğŸ“Š ì˜ˆìƒ íš¨ê³¼: ì‹œì²­ ì™„ë£Œìœ¨ +30%, ì €ì¥ìœ¨ +50%`
  }
  
  const templateFn = templates[type] || templates.idea
  return templateFn(userInput)
}

